<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="enrolled-programs">

  <template>

    <style>
      /*MAIN*/
      :host #content{
        font-size: var(--patient-medication-font-size , 20pt);
        color: var(--patient-medication-font-color , rgb(24, 24, 24));
        background-color: var(--patient-medication-background-color , inherit);
        padding: var(--patient-medication-padding , 10px);
      }


    </style>

    <div id="content">
      <template is="dom-repeat" items="[[toShow]]">
        <p>

        </p>
      </template>
    </div>

    <iron-ajax
    url="{{url}}"
    headers='{"Accept": "application/json+fhir"}'
    content-type="application/json"
    handle-as="json"
    on-response="handleResponse"
    method="GET"
    on-error="_error"
    id="iron_ajax"/>

  </template>

  <script>
    class EnrolledPrograms extends Polymer.Element {
      static get is() {
        return 'enrolled-programs';
      }
      static get properties() {
        return {
          toShow: {
            type: Array
          },
          patientid: {
            type: String,
            observer: "_changedPatientID"
          },
          url: {
            type: String
          }
        }
      }

      constructor() {
        super();
      }


      handleResponse(data) {
        var enrolledPrograms = data.detail.response.entry;
        if(enrolledPrograms){
          this.toShow = enrolledPrograms;
        }else{
          __notFound(this.$.content)
        }
      }

      _changedPatientID(){
        this.url = "http://sqlonfhir-stu3.azurewebsites.net/fhir/MedicationDispense?patient=" + this.patientid;
        this.$.iron_ajax.generateRequest();
      }

      displayIndex(index) {
        return index + 1;
      }

      _error(event) {
        __ironAjaxError(event);
      }

    }
    customElements.define(EnrolledPrograms.is, EnrolledPrograms);
  </script>

</dom-module>
